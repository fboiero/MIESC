<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - MIESC Agent Protocol</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 40px 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
        }
        h2 {
            font-size: 32px;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        h3 {
            font-size: 24px;
            margin-top: 30px;
            color: #ffd700;
        }
        .section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
        }
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            margin: 15px 0;
        }
        .code-block .comment {
            color: #6a9955;
        }
        .code-block .keyword {
            color: #569cd6;
        }
        .code-block .string {
            color: #ce9178;
        }
        .code-block .property {
            color: #9cdcfe;
        }
        .endpoint {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .endpoint h4 {
            margin-top: 0;
            color: #ffd700;
            font-size: 20px;
        }
        .method {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-weight: bold;
            font-size: 14px;
            margin-right: 10px;
        }
        .method.post {
            background: #28a745;
        }
        .method.get {
            background: #17a2b8;
        }
        .parameter {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-left: 3px solid #ffd700;
            margin: 10px 0;
            border-radius: 5px;
        }
        .parameter-name {
            color: #ffd700;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        .required {
            color: #ff6b6b;
            font-size: 12px;
            margin-left: 10px;
        }
        .optional {
            color: #95e1d3;
            font-size: 12px;
            margin-left: 10px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: white;
            text-decoration: none;
            font-size: 18px;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        th {
            background: rgba(102, 126, 234, 0.3);
            font-weight: bold;
        }
        .response-example {
            background: #0c0c0c;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 15px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">‚Üê Back to Home</a>

        <h1>üîå API Documentation</h1>
        <p style="text-align: center; font-size: 20px; margin-bottom: 40px;">
            Model Context Protocol (MCP) and Python API Reference
        </p>

        <!-- Introduction -->
        <div class="section">
            <h2>üìñ Introduction</h2>
            <p style="font-size: 18px; line-height: 1.8;">
                MIESC exposes its security analysis capabilities through two interfaces:
            </p>
            <ul style="font-size: 16px; line-height: 1.8;">
                <li><strong>Python API:</strong> Direct programmatic access for Python applications</li>
                <li><strong>MCP Server:</strong> Standard protocol for AI assistant integration (Claude, etc.)</li>
            </ul>

            <p style="font-size: 16px; line-height: 1.8; margin-top: 20px;">
                Both interfaces provide access to the same underlying agent orchestration system.
            </p>
        </div>

        <!-- Python API -->
        <div class="section">
            <h2>üêç Python API</h2>

            <h3>Installation</h3>
            <div class="code-block">
pip install miesc
            </div>

            <h3>Quick Start</h3>
            <div class="code-block">
<span class="keyword">from</span> src.orchestrator <span class="keyword">import</span> AgentOrchestrator, SelectionCriteria
<span class="keyword">from</span> src.core.agent_protocol <span class="keyword">import</span> AgentCapability

<span class="comment"># Initialize orchestrator</span>
orchestrator = AgentOrchestrator()
orchestrator.initialize()

<span class="comment"># Define criteria</span>
criteria = SelectionCriteria(
    language=<span class="string">'solidity'</span>,
    capabilities=[AgentCapability.STATIC_ANALYSIS],
    free_only=<span class="keyword">True</span>
)

<span class="comment"># Select agents</span>
agents = orchestrator.select_agents(<span class="string">'contract.sol'</span>, criteria)

<span class="comment"># Run analysis</span>
result = orchestrator.analyze(<span class="string">'contract.sol'</span>, agents)

<span class="comment"># Access results</span>
<span class="keyword">print</span>(<span class="string">f'Total findings: </span>{result.get_summary()["total_findings"]}<span class="string">'</span>)
            </div>

            <h3>AgentOrchestrator Class</h3>

            <div class="endpoint">
                <h4>initialize()</h4>
                <p>Initializes the orchestrator and discovers all available agents.</p>

                <p style="margin-top: 15px;"><strong>Returns:</strong> None</p>

                <p style="margin-top: 15px;"><strong>Example:</strong></p>
                <div class="code-block">
orchestrator = AgentOrchestrator()
orchestrator.initialize()
                </div>
            </div>

            <div class="endpoint">
                <h4>get_available_agents()</h4>
                <p>Returns list of all available agent names.</p>

                <p style="margin-top: 15px;"><strong>Returns:</strong> <span class="parameter-name">List[str]</span></p>

                <p style="margin-top: 15px;"><strong>Example:</strong></p>
                <div class="code-block">
agent_names = orchestrator.get_available_agents()
<span class="comment"># ['slither', 'mythril', 'semgrep', ...]</span>
                </div>
            </div>

            <div class="endpoint">
                <h4>get_agent_info(agent_name: str)</h4>
                <p>Returns detailed information about a specific agent.</p>

                <div class="parameter">
                    <span class="parameter-name">agent_name</span><span class="required">required</span>
                    <p>Name of the agent to query</p>
                </div>

                <p style="margin-top: 15px;"><strong>Returns:</strong> <span class="parameter-name">Dict[str, Any]</span></p>

                <p style="margin-top: 15px;"><strong>Example:</strong></p>
                <div class="code-block">
info = orchestrator.get_agent_info(<span class="string">'slither'</span>)
<span class="keyword">print</span>(info[<span class="string">'description'</span>])
<span class="keyword">print</span>(info[<span class="string">'capabilities'</span>])
                </div>
            </div>

            <div class="endpoint">
                <h4>select_agents(contract: str, criteria: SelectionCriteria)</h4>
                <p>Selects appropriate agents based on criteria and contract.</p>

                <div class="parameter">
                    <span class="parameter-name">contract</span><span class="required">required</span>
                    <p>Path to contract file or directory</p>
                </div>

                <div class="parameter">
                    <span class="parameter-name">criteria</span><span class="required">required</span>
                    <p>SelectionCriteria object defining requirements</p>
                </div>

                <p style="margin-top: 15px;"><strong>Returns:</strong> <span class="parameter-name">List[SecurityAgent]</span></p>

                <p style="margin-top: 15px;"><strong>Example:</strong></p>
                <div class="code-block">
criteria = SelectionCriteria(
    language=<span class="string">'solidity'</span>,
    capabilities=[AgentCapability.STATIC_ANALYSIS],
    free_only=<span class="keyword">True</span>,
    max_speed=AgentSpeed.MEDIUM
)
agents = orchestrator.select_agents(<span class="string">'contract.sol'</span>, criteria)
                </div>
            </div>

            <div class="endpoint">
                <h4>analyze(contract: str, agents: List[SecurityAgent], parallel: bool = True)</h4>
                <p>Executes analysis with selected agents.</p>

                <div class="parameter">
                    <span class="parameter-name">contract</span><span class="required">required</span>
                    <p>Path to contract file or directory</p>
                </div>

                <div class="parameter">
                    <span class="parameter-name">agents</span><span class="required">required</span>
                    <p>List of agents to execute</p>
                </div>

                <div class="parameter">
                    <span class="parameter-name">parallel</span><span class="optional">optional</span>
                    <p>Execute agents in parallel (default: True)</p>
                </div>

                <p style="margin-top: 15px;"><strong>Returns:</strong> <span class="parameter-name">OrchestrationResult</span></p>

                <p style="margin-top: 15px;"><strong>Example:</strong></p>
                <div class="code-block">
result = orchestrator.analyze(
    <span class="string">'contract.sol'</span>,
    agents,
    parallel=<span class="keyword">True</span>
)
                </div>
            </div>

            <h3>SelectionCriteria Class</h3>

            <div class="code-block">
<span class="keyword">from</span> src.orchestrator <span class="keyword">import</span> SelectionCriteria
<span class="keyword">from</span> src.core.agent_protocol <span class="keyword">import</span> AgentCapability, AgentSpeed

criteria = SelectionCriteria(
    language=<span class="string">'solidity'</span>,           <span class="comment"># Target language</span>
    capabilities=[...],              <span class="comment"># Required capabilities</span>
    free_only=<span class="keyword">True</span>,                <span class="comment"># Only free agents</span>
    max_speed=AgentSpeed.MEDIUM,     <span class="comment"># Maximum speed</span>
    specific_agents=[<span class="string">'slither'</span>]    <span class="comment"># Specific agent names</span>
)
            </div>

            <table>
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>language</code></td>
                        <td>str</td>
                        <td>Optional</td>
                        <td>Target language (e.g., 'solidity', 'vyper', 'rust')</td>
                    </tr>
                    <tr>
                        <td><code>capabilities</code></td>
                        <td>List[AgentCapability]</td>
                        <td>Optional</td>
                        <td>Required capabilities</td>
                    </tr>
                    <tr>
                        <td><code>free_only</code></td>
                        <td>bool</td>
                        <td>Optional</td>
                        <td>Only include free agents (default: False)</td>
                    </tr>
                    <tr>
                        <td><code>max_speed</code></td>
                        <td>AgentSpeed</td>
                        <td>Optional</td>
                        <td>Maximum acceptable speed</td>
                    </tr>
                    <tr>
                        <td><code>specific_agents</code></td>
                        <td>List[str]</td>
                        <td>Optional</td>
                        <td>Specific agent names to use</td>
                    </tr>
                </tbody>
            </table>

            <h3>OrchestrationResult Class</h3>

            <div class="code-block">
<span class="comment"># Access result properties</span>
result.agents_run           <span class="comment"># Total agents executed</span>
result.agents_success       <span class="comment"># Successfully completed</span>
result.agents_failed        <span class="comment"># Failed agents</span>
result.total_execution_time <span class="comment"># Total time in seconds</span>
result.results              <span class="comment"># List[AnalysisResult]</span>

<span class="comment"># Get consolidated summary</span>
summary = result.get_summary()
<span class="keyword">print</span>(summary[<span class="string">'total_findings'</span>])
<span class="keyword">print</span>(summary[<span class="string">'by_severity'</span>][<span class="string">'CRITICAL'</span>])

<span class="comment"># Get all findings</span>
findings = result.get_all_findings()
<span class="keyword">for</span> finding <span class="keyword">in</span> findings:
    <span class="keyword">print</span>(<span class="string">f'</span>{finding.severity}<span class="string">: </span>{finding.title}<span class="string">'</span>)
            </div>
        </div>

        <!-- MCP API -->
        <div class="section">
            <h2>ü§ñ MCP (Model Context Protocol) API</h2>

            <p style="font-size: 18px; line-height: 1.8;">
                MIESC implements the Model Context Protocol for integration with AI assistants like Claude.
            </p>

            <h3>Starting the MCP Server</h3>
            <div class="code-block">
<span class="comment"># Start the MCP server</span>
python mcp_server.py
            </div>

            <h3>Available MCP Tools</h3>

            <div class="endpoint">
                <h4>analyze_contract</h4>
                <p>Analyzes a smart contract using selected security agents.</p>

                <p style="margin-top: 15px;"><strong>Parameters:</strong></p>

                <div class="parameter">
                    <span class="parameter-name">contract_path</span><span class="required">required</span>
                    <p>Path to the contract file or directory</p>
                </div>

                <div class="parameter">
                    <span class="parameter-name">agents</span><span class="optional">optional</span>
                    <p>List of specific agent names to use. If not provided, auto-selects appropriate agents.</p>
                </div>

                <div class="parameter">
                    <span class="parameter-name">language</span><span class="optional">optional</span>
                    <p>Contract language (e.g., 'solidity', 'vyper'). Auto-detected if not provided.</p>
                </div>

                <div class="parameter">
                    <span class="parameter-name">free_only</span><span class="optional">optional</span>
                    <p>Only use free agents (default: true)</p>
                </div>

                <p style="margin-top: 20px;"><strong>Example Request:</strong></p>
                <div class="code-block">
{
  <span class="property">"method"</span>: <span class="string">"tools/call"</span>,
  <span class="property">"params"</span>: {
    <span class="property">"name"</span>: <span class="string">"analyze_contract"</span>,
    <span class="property">"arguments"</span>: {
      <span class="property">"contract_path"</span>: <span class="string">"/path/to/contract.sol"</span>,
      <span class="property">"agents"</span>: [<span class="string">"slither"</span>, <span class="string">"mythril"</span>],
      <span class="property">"free_only"</span>: <span class="keyword">true</span>
    }
  }
}
                </div>

                <p style="margin-top: 20px;"><strong>Example Response:</strong></p>
                <div class="response-example">
{
  "agents_executed": 2,
  "agents_success": 2,
  "total_findings": 15,
  "findings_by_severity": {
    "CRITICAL": 2,
    "HIGH": 5,
    "MEDIUM": 6,
    "LOW": 2
  },
  "execution_time": 12.5,
  "findings": [
    {
      "agent": "slither",
      "severity": "HIGH",
      "title": "Reentrancy vulnerability",
      "description": "Function withdraw() is vulnerable to reentrancy",
      "location": "contract.sol:45",
      "recommendation": "Use ReentrancyGuard or checks-effects-interactions pattern"
    },
    ...
  ]
}
                </div>
            </div>

            <div class="endpoint">
                <h4>list_agents</h4>
                <p>Lists all available security agents.</p>

                <p style="margin-top: 15px;"><strong>Parameters:</strong> None</p>

                <p style="margin-top: 20px;"><strong>Example Response:</strong></p>
                <div class="response-example">
{
  "agents": [
    {
      "name": "slither",
      "version": "0.10.0",
      "description": "Static analysis framework for Solidity",
      "capabilities": ["STATIC_ANALYSIS"],
      "languages": ["solidity"],
      "cost": 0.0,
      "speed": "FAST"
    },
    {
      "name": "mythril",
      "version": "0.24.0",
      "description": "Symbolic execution tool for EVM",
      "capabilities": ["SYMBOLIC_EXECUTION"],
      "languages": ["solidity"],
      "cost": 0.0,
      "speed": "SLOW"
    },
    ...
  ]
}
                </div>
            </div>

            <div class="endpoint">
                <h4>get_agent_info</h4>
                <p>Gets detailed information about a specific agent.</p>

                <p style="margin-top: 15px;"><strong>Parameters:</strong></p>

                <div class="parameter">
                    <span class="parameter-name">agent_name</span><span class="required">required</span>
                    <p>Name of the agent</p>
                </div>

                <p style="margin-top: 20px;"><strong>Example Response:</strong></p>
                <div class="response-example">
{
  "name": "slither",
  "version": "0.10.0",
  "description": "Static analysis framework for Solidity by Trail of Bits",
  "author": "Trail of Bits",
  "license": "AGPL-3.0",
  "capabilities": ["STATIC_ANALYSIS"],
  "languages": ["solidity"],
  "cost": 0.0,
  "speed": "FAST",
  "is_available": true,
  "config_schema": {
    "exclude_detectors": "List of detector IDs to exclude",
    "exclude_informational": "Exclude informational findings"
  }
}
                </div>
            </div>
        </div>

        <!-- Data Structures -->
        <div class="section">
            <h2>üìä Data Structures</h2>

            <h3>Finding</h3>
            <div class="code-block">
{
  <span class="property">"title"</span>: <span class="string">"Reentrancy vulnerability"</span>,
  <span class="property">"severity"</span>: <span class="string">"HIGH"</span>,  <span class="comment">// CRITICAL, HIGH, MEDIUM, LOW, INFO</span>
  <span class="property">"description"</span>: <span class="string">"Detailed description..."</span>,
  <span class="property">"location"</span>: {
    <span class="property">"file"</span>: <span class="string">"contract.sol"</span>,
    <span class="property">"line"</span>: 45,
    <span class="property">"column"</span>: 12
  },
  <span class="property">"code_snippet"</span>: <span class="string">"function withdraw() public { ... }"</span>,
  <span class="property">"recommendation"</span>: <span class="string">"Use ReentrancyGuard..."</span>,
  <span class="property">"references"</span>: [
    <span class="string">"https://swcregistry.io/docs/SWC-107"</span>
  ]
}
            </div>

            <h3>AnalysisResult</h3>
            <div class="code-block">
{
  <span class="property">"agent"</span>: <span class="string">"slither"</span>,
  <span class="property">"version"</span>: <span class="string">"0.10.0"</span>,
  <span class="property">"status"</span>: <span class="string">"SUCCESS"</span>,  <span class="comment">// SUCCESS, ERROR, TIMEOUT</span>
  <span class="property">"timestamp"</span>: <span class="string">"2025-10-15T12:34:56Z"</span>,
  <span class="property">"execution_time"</span>: 2.5,
  <span class="property">"findings"</span>: [...],
  <span class="property">"summary"</span>: {
    <span class="property">"total"</span>: 8,
    <span class="property">"by_severity"</span>: {
      <span class="property">"CRITICAL"</span>: 0,
      <span class="property">"HIGH"</span>: 2,
      <span class="property">"MEDIUM"</span>: 4,
      <span class="property">"LOW"</span>: 2
    }
  },
  <span class="property">"error"</span>: <span class="keyword">null</span>  <span class="comment">// Error message if status is ERROR</span>
}
            </div>

            <h3>AgentCapability (Enum)</h3>
            <div class="code-block">
<span class="string">"STATIC_ANALYSIS"</span>       <span class="comment"># Pattern-based analysis</span>
<span class="string">"SYMBOLIC_EXECUTION"</span>    <span class="comment"># Path exploration</span>
<span class="string">"FUZZING"</span>               <span class="comment"># Property-based testing</span>
<span class="string">"FORMAL_VERIFICATION"</span>   <span class="comment"># Mathematical proofs</span>
<span class="string">"AI_ANALYSIS"</span>           <span class="comment"># ML/LLM-based analysis</span>
<span class="string">"RUNTIME_MONITORING"</span>    <span class="comment"># Live transaction monitoring</span>
            </div>

            <h3>AgentSpeed (Enum)</h3>
            <div class="code-block">
<span class="string">"FAST"</span>      <span class="comment"># < 10 seconds</span>
<span class="string">"MEDIUM"</span>    <span class="comment"># 10 seconds - 5 minutes</span>
<span class="string">"SLOW"</span>      <span class="comment"># > 5 minutes</span>
            </div>
        </div>

        <!-- Error Handling -->
        <div class="section">
            <h2>‚ö†Ô∏è Error Handling</h2>

            <h3>Python API Exceptions</h3>
            <div class="code-block">
<span class="keyword">from</span> src.orchestrator <span class="keyword">import</span> AgentOrchestrator

<span class="keyword">try</span>:
    orchestrator = AgentOrchestrator()
    orchestrator.initialize()
    result = orchestrator.analyze(<span class="string">'contract.sol'</span>, agents)
<span class="keyword">except</span> FileNotFoundError:
    <span class="keyword">print</span>(<span class="string">"Contract file not found"</span>)
<span class="keyword">except</span> ValueError:
    <span class="keyword">print</span>(<span class="string">"Invalid parameters"</span>)
<span class="keyword">except</span> Exception <span class="keyword">as</span> e:
    <span class="keyword">print</span>(<span class="string">f"Analysis failed: </span>{e}<span class="string">"</span>)
            </div>

            <h3>MCP Error Responses</h3>
            <div class="response-example">
{
  "error": {
    "code": -32602,
    "message": "Invalid params: contract_path is required",
    "data": {
      "param": "contract_path"
    }
  }
}
            </div>

            <p style="margin-top: 20px;"><strong>Common Error Codes:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Meaning</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>-32600</td>
                        <td>Invalid Request</td>
                    </tr>
                    <tr>
                        <td>-32601</td>
                        <td>Method not found</td>
                    </tr>
                    <tr>
                        <td>-32602</td>
                        <td>Invalid params</td>
                    </tr>
                    <tr>
                        <td>-32603</td>
                        <td>Internal error</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Rate Limits -->
        <div class="section">
            <h2>‚è±Ô∏è Rate Limits</h2>
            <p style="font-size: 16px; line-height: 1.8;">
                Currently, there are no rate limits for local Python API usage. For MCP server usage,
                rate limits may apply depending on the deployment configuration.
            </p>

            <p style="font-size: 16px; line-height: 1.8; margin-top: 20px;">
                <strong>Best Practices:</strong>
            </p>
            <ul style="font-size: 16px; line-height: 1.8;">
                <li>Cache analysis results when analyzing the same contract repeatedly</li>
                <li>Use parallel execution judiciously (respects system resources)</li>
                <li>Set appropriate timeouts for slow agents</li>
            </ul>
        </div>

        <!-- Learn More -->
        <div class="section">
            <h2>üìö Learn More</h2>
            <p style="text-align: center; font-size: 18px; margin: 30px 0;">
                Dive deeper into the MIESC ecosystem:
            </p>

            <div style="text-align: center;">
                <a href="../docs/AGENT_DEVELOPMENT_GUIDE.md" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; margin: 10px 5px; border: 2px solid rgba(255, 255, 255, 0.3);">üîß Developer Guide</a>
                <a href="demo.html" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; margin: 10px 5px; border: 2px solid rgba(255, 255, 255, 0.3);">üöÄ Try Demo</a>
                <a href="architecture.html" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; margin: 10px 5px; border: 2px solid rgba(255, 255, 255, 0.3);">üèóÔ∏è Architecture</a>
            </div>
        </div>

        <!-- Back to Home -->
        <div style="text-align: center; margin-top: 40px;">
            <a href="../index.html" class="back-link">‚Üê Back to Home</a>
        </div>
    </div>
</body>
</html>
