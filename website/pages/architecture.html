<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture - MIESC Agent Protocol</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 40px 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
        }
        h2 {
            font-size: 32px;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 10px;
        }
        h3 {
            font-size: 24px;
            margin-top: 30px;
            color: #ffd700;
        }
        .section {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
        }
        .diagram {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .component {
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .layer {
            background: linear-gradient(to right, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.3));
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: white;
            text-decoration: none;
            font-size: 18px;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .code-inline {
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        ul, ol {
            line-height: 1.8;
            font-size: 16px;
        }
        .highlight-box {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">← Back to Home</a>

        <h1>🏗️ Architecture</h1>
        <p style="text-align: center; font-size: 20px; margin-bottom: 40px;">
            Technical architecture of the MIESC Agent Protocol
        </p>

        <!-- System Overview -->
        <div class="section">
            <h2>📐 System Overview</h2>
            <p style="font-size: 18px; line-height: 1.8;">
                MIESC Agent Protocol is built on a layered architecture that separates concerns and enables
                extensibility. The system is designed around three core principles: <strong>standardization</strong>,
                <strong>modularity</strong>, and <strong>openness</strong>.
            </p>

            <div class="diagram">
                <pre style="font-size: 14px; line-height: 1.6;">
┌─────────────────────────────────────────────────────────────────┐
│                      Application Layer                           │
│  ┌───────────────┐  ┌──────────────┐  ┌────────────────────┐  │
│  │  CLI Interface│  │  Web UI      │  │  CI/CD Integration │  │
│  └───────────────┘  └──────────────┘  └────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Orchestration Layer                           │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │              AgentOrchestrator                              │ │
│  │  • Agent Selection      • Parallel Execution               │ │
│  │  • Result Consolidation • Error Handling                   │ │
│  └────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Protocol Layer                              │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │              SecurityAgent Protocol                         │ │
│  │  • Standard Interface   • Metadata Schema                  │ │
│  │  • Result Format        • Capability Definitions           │ │
│  └────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Registry Layer                              │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │              AgentRegistry                                  │ │
│  │  • Agent Discovery      • Dynamic Loading                  │ │
│  │  • Validation           • Marketplace Integration          │ │
│  └────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Agent Layer                               │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────────────┐  │
│  │ Slither │  │ Mythril │  │ Semgrep │  │ Your Agent Here │  │
│  └─────────┘  └─────────┘  └─────────┘  └─────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     External Tools Layer                         │
│  • Static Analyzers  • Symbolic Execution  • Fuzzers           │
│  • Formal Verification  • ML Models  • Custom Tools            │
└─────────────────────────────────────────────────────────────────┘
                </pre>
            </div>
        </div>

        <!-- Core Components -->
        <div class="section">
            <h2>🔧 Core Components</h2>

            <div class="component">
                <h3>1. SecurityAgent Protocol</h3>
                <p><strong>Location:</strong> <span class="code-inline">src/core/agent_protocol.py</span></p>
                <p><strong>Purpose:</strong> Defines the standard interface that all security agents must implement.</p>

                <p style="margin-top: 20px;"><strong>Key Elements:</strong></p>
                <ul>
                    <li><strong>Abstract Base Class:</strong> <span class="code-inline">SecurityAgent</span></li>
                    <li><strong>Metadata Properties:</strong> name, version, description, author, license</li>
                    <li><strong>Capability Definitions:</strong> static_analysis, symbolic_execution, fuzzing, etc.</li>
                    <li><strong>Analysis Interface:</strong> <span class="code-inline">analyze()</span> method</li>
                    <li><strong>Result Format:</strong> <span class="code-inline">AnalysisResult</span> dataclass</li>
                    <li><strong>Finding Schema:</strong> <span class="code-inline">Finding</span> with severity, location, recommendations</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Design Principles:</strong></p>
                <ul>
                    <li>Language-agnostic (supports Solidity, Vyper, Rust, etc.)</li>
                    <li>Tool-agnostic (works with any analysis tool)</li>
                    <li>Extensible (new capabilities can be added)</li>
                    <li>Versioned (supports protocol evolution)</li>
                </ul>
            </div>

            <div class="component">
                <h3>2. AgentRegistry</h3>
                <p><strong>Location:</strong> <span class="code-inline">src/core/agent_registry.py</span></p>
                <p><strong>Purpose:</strong> Discovers, loads, and manages available security agents.</p>

                <p style="margin-top: 20px;"><strong>Key Features:</strong></p>
                <ul>
                    <li><strong>Multi-Source Discovery:</strong>
                        <ul>
                            <li>Built-in agents (<span class="code-inline">src/agents/</span>)</li>
                            <li>User agents (<span class="code-inline">~/.miesc/agents/</span>)</li>
                            <li>Marketplace agents (future)</li>
                        </ul>
                    </li>
                    <li><strong>Dynamic Loading:</strong> Uses Python's importlib for runtime agent loading</li>
                    <li><strong>Validation:</strong> Ensures agents properly implement SecurityAgent protocol</li>
                    <li><strong>Filtering:</strong> Query agents by language, capability, cost, speed</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Discovery Algorithm:</strong></p>
                <ol>
                    <li>Scan plugin directories for Python files</li>
                    <li>Load modules dynamically</li>
                    <li>Inspect for SecurityAgent subclasses</li>
                    <li>Instantiate and validate agents</li>
                    <li>Register in internal dictionary</li>
                </ol>
            </div>

            <div class="component">
                <h3>3. AgentOrchestrator</h3>
                <p><strong>Location:</strong> <span class="code-inline">src/orchestrator.py</span></p>
                <p><strong>Purpose:</strong> Coordinates multi-agent analysis and result consolidation.</p>

                <p style="margin-top: 20px;"><strong>Key Responsibilities:</strong></p>
                <ul>
                    <li><strong>Agent Selection:</strong> Intelligently selects appropriate agents based on criteria</li>
                    <li><strong>Execution Management:</strong>
                        <ul>
                            <li>Parallel execution using ThreadPoolExecutor</li>
                            <li>Sequential execution for dependencies</li>
                            <li>Timeout management</li>
                            <li>Error isolation (one agent failure doesn't stop others)</li>
                        </ul>
                    </li>
                    <li><strong>Result Consolidation:</strong>
                        <ul>
                            <li>Aggregates findings from all agents</li>
                            <li>Deduplicates similar findings</li>
                            <li>Calculates aggregate metrics</li>
                            <li>Generates unified dashboard</li>
                        </ul>
                    </li>
                </ul>

                <p style="margin-top: 20px;"><strong>Selection Criteria:</strong></p>
                <ul>
                    <li>Language compatibility</li>
                    <li>Required capabilities</li>
                    <li>Cost constraints (free_only flag)</li>
                    <li>Speed requirements</li>
                    <li>Specific agent names</li>
                </ul>
            </div>
        </div>

        <!-- Data Flow -->
        <div class="section">
            <h2>🔄 Data Flow</h2>

            <h3>Typical Analysis Flow:</h3>
            <div class="diagram">
                <pre style="font-size: 14px; line-height: 1.6;">
1. User Request
   ↓
2. Orchestrator initializes and discovers agents
   ↓
3. Agent Selection based on criteria
   │
   ├─→ Check language compatibility
   ├─→ Filter by capabilities
   ├─→ Apply cost/speed constraints
   └─→ Validate agent availability
   ↓
4. Execute Analysis (Parallel or Sequential)
   │
   ├─→ Agent A: analyze(contract) → AnalysisResult
   ├─→ Agent B: analyze(contract) → AnalysisResult
   └─→ Agent C: analyze(contract) → AnalysisResult
   ↓
5. Result Consolidation
   │
   ├─→ Collect all findings
   ├─→ Deduplicate similar issues
   ├─→ Calculate aggregate statistics
   └─→ Generate unified report
   ↓
6. Output Generation
   │
   ├─→ JSON report (machine-readable)
   ├─→ HTML dashboard (human-readable)
   ├─→ Console summary
   └─→ CI/CD artifacts
                </pre>
            </div>

            <div class="highlight-box">
                <h3 style="margin-top: 0;">🔑 Key Design Decision: Protocol-First</h3>
                <p style="font-size: 16px; line-height: 1.8;">
                    The architecture is <strong>protocol-first</strong>, meaning the SecurityAgent interface is the
                    contract between the system and external tools. This allows:
                </p>
                <ul>
                    <li>Tool developers to work independently without coordinating</li>
                    <li>Multiple implementations of the same analysis technique</li>
                    <li>Evolution of the protocol without breaking existing agents</li>
                    <li>Community-driven standards development</li>
                </ul>
            </div>
        </div>

        <!-- Defense-in-Depth Security Architecture -->
        <div class="section">
            <h2>🛡️ Defense-in-Depth Security Architecture</h2>
            <p style="font-size: 18px; line-height: 1.8;">
                MIESC implements a 6-layer security architecture for comprehensive smart contract analysis:
            </p>

            <div class="layer">
                <h3>Layer 1: Static Analysis</h3>
                <p><strong>Tools:</strong> Slither, Semgrep, Custom Pattern Matchers</p>
                <p><strong>Detects:</strong> Known vulnerability patterns, code smells, best practice violations</p>
                <p><strong>Speed:</strong> Fast (seconds)</p>
            </div>

            <div class="layer">
                <h3>Layer 2: Symbolic Execution</h3>
                <p><strong>Tools:</strong> Mythril, Manticore</p>
                <p><strong>Detects:</strong> Deep vulnerabilities, path-specific issues, integer overflow</p>
                <p><strong>Speed:</strong> Slow (minutes to hours)</p>
            </div>

            <div class="layer">
                <h3>Layer 3: Fuzzing</h3>
                <p><strong>Tools:</strong> Echidna, Foundry Fuzz</p>
                <p><strong>Detects:</strong> Edge cases, unexpected behavior, invariant violations</p>
                <p><strong>Speed:</strong> Medium (seconds to minutes)</p>
            </div>

            <div class="layer">
                <h3>Layer 4: Formal Verification</h3>
                <p><strong>Tools:</strong> K Framework, Certora</p>
                <p><strong>Detects:</strong> Logical errors, specification violations</p>
                <p><strong>Speed:</strong> Very Slow (hours to days)</p>
            </div>

            <div class="layer">
                <h3>Layer 5: AI/ML Analysis</h3>
                <p><strong>Tools:</strong> LLM-based analyzers, ML models</p>
                <p><strong>Detects:</strong> Novel patterns, contextual issues, code quality</p>
                <p><strong>Speed:</strong> Medium (seconds to minutes)</p>
            </div>

            <div class="layer">
                <h3>Layer 6: Runtime Monitoring</h3>
                <p><strong>Tools:</strong> Forta agents, OpenZeppelin Defender</p>
                <p><strong>Detects:</strong> Suspicious transactions, attacks in progress</p>
                <p><strong>Speed:</strong> Real-time</p>
            </div>
        </div>

        <!-- Extensibility -->
        <div class="section">
            <h2>🔌 Extensibility</h2>

            <h3>Adding New Capabilities</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                The protocol supports adding new capabilities without breaking existing agents:
            </p>

            <div class="component">
                <p><strong>Current Capabilities:</strong></p>
                <ul>
                    <li>STATIC_ANALYSIS</li>
                    <li>SYMBOLIC_EXECUTION</li>
                    <li>FUZZING</li>
                    <li>FORMAL_VERIFICATION</li>
                    <li>AI_ANALYSIS</li>
                    <li>RUNTIME_MONITORING</li>
                </ul>

                <p style="margin-top: 20px;"><strong>Future Capabilities (Examples):</strong></p>
                <ul>
                    <li>GAS_OPTIMIZATION</li>
                    <li>COMPLIANCE_CHECKING</li>
                    <li>DEPENDENCY_ANALYSIS</li>
                    <li>CODE_QUALITY</li>
                    <li>DOCUMENTATION_GENERATION</li>
                </ul>
            </div>

            <h3 style="margin-top: 30px;">Supporting New Languages</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                Agents declare which languages they support. The protocol is language-agnostic:
            </p>
            <ul>
                <li><strong>Current:</strong> Solidity, Vyper, Rust (CosmWasm)</li>
                <li><strong>Potential:</strong> Cairo, Move, Yul, Huff, Fe</li>
            </ul>

            <h3 style="margin-top: 30px;">Custom Agent Types</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                The protocol supports various agent architectures:
            </p>
            <ul>
                <li><strong>Wrapper Agents:</strong> Wrap existing CLI tools (e.g., Slither, Mythril)</li>
                <li><strong>Native Agents:</strong> Implement analysis directly in Python</li>
                <li><strong>API Agents:</strong> Call remote services (e.g., cloud-based AI analyzers)</li>
                <li><strong>Composite Agents:</strong> Combine multiple techniques</li>
            </ul>
        </div>

        <!-- Performance Considerations -->
        <div class="section">
            <h2>⚡ Performance Considerations</h2>

            <div class="component">
                <h3>Parallel Execution</h3>
                <p>Agents run in parallel using ThreadPoolExecutor, significantly reducing total analysis time:</p>
                <ul>
                    <li><strong>Sequential:</strong> Time = Sum of all agent times</li>
                    <li><strong>Parallel:</strong> Time ≈ Max of all agent times</li>
                </ul>
                <p style="margin-top: 15px;"><strong>Example:</strong> 3 agents (10s, 15s, 5s each)</p>
                <ul>
                    <li>Sequential: 30 seconds total</li>
                    <li>Parallel: ~15 seconds total (50% reduction)</li>
                </ul>
            </div>

            <div class="component">
                <h3>Caching Strategy</h3>
                <p>Results can be cached to avoid redundant analysis:</p>
                <ul>
                    <li>Content-based hashing (analyze same contract = use cached results)</li>
                    <li>Time-based expiration</li>
                    <li>Invalidation on agent version changes</li>
                </ul>
            </div>

            <div class="component">
                <h3>Resource Management</h3>
                <ul>
                    <li><strong>Timeouts:</strong> Prevent agents from running indefinitely</li>
                    <li><strong>Memory Limits:</strong> Isolate agents to prevent memory exhaustion</li>
                    <li><strong>Process Isolation:</strong> (Future) Run agents in separate processes/containers</li>
                </ul>
            </div>
        </div>

        <!-- Integration Points -->
        <div class="section">
            <h2>🔗 Integration Points</h2>

            <h3>MCP (Model Context Protocol)</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                MIESC implements Anthropic's MCP standard for AI assistant integration:
            </p>
            <ul>
                <li>Exposes tools (agents) as MCP resources</li>
                <li>Enables Claude and other AI assistants to invoke security analysis</li>
                <li>Standardized communication protocol</li>
            </ul>

            <h3 style="margin-top: 30px;">CI/CD Integration</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                Designed for seamless CI/CD integration:
            </p>
            <ul>
                <li>Exit codes indicate analysis success/failure</li>
                <li>JSON output for machine parsing</li>
                <li>Configurable severity thresholds</li>
                <li>Artifact generation (reports, badges)</li>
            </ul>

            <h3 style="margin-top: 30px;">IDE Plugins</h3>
            <p style="font-size: 16px; line-height: 1.8;">
                Future integration with development environments:
            </p>
            <ul>
                <li>VS Code extension</li>
                <li>Inline vulnerability warnings</li>
                <li>On-save analysis</li>
                <li>Quick fix suggestions</li>
            </ul>
        </div>

        <!-- Future Architecture -->
        <div class="section">
            <h2>🚀 Future Architecture Enhancements</h2>

            <div class="highlight-box">
                <h3 style="margin-top: 0;">Distributed Agent Execution</h3>
                <p>Run agents on remote servers for better performance and isolation:</p>
                <ul>
                    <li>Agent marketplace with hosted execution</li>
                    <li>Load balancing across agent instances</li>
                    <li>Geographic distribution for low latency</li>
                </ul>
            </div>

            <div class="highlight-box">
                <h3 style="margin-top: 0;">Agent Composition</h3>
                <p>Allow agents to call other agents, creating analysis pipelines:</p>
                <ul>
                    <li>Pre-processing agents (normalize code)</li>
                    <li>Analysis agents (find vulnerabilities)</li>
                    <li>Post-processing agents (prioritize findings)</li>
                </ul>
            </div>

            <div class="highlight-box">
                <h3 style="margin-top: 0;">Machine Learning Integration</h3>
                <p>Learn from historical analysis to improve accuracy:</p>
                <ul>
                    <li>False positive detection</li>
                    <li>Vulnerability prediction</li>
                    <li>Agent recommendation</li>
                </ul>
            </div>
        </div>

        <!-- Learn More -->
        <div class="section">
            <h2>📚 Learn More</h2>
            <p style="font-size: 18px; text-align: center; margin: 30px 0;">
                Explore the technical details:
            </p>

            <div style="text-align: center;">
                <a href="../AGENT_PROTOCOL_WHITEPAPER.md" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; margin: 10px 5px; border: 2px solid rgba(255, 255, 255, 0.3);">📄 Read Whitepaper</a>
                <a href="../docs/AGENT_DEVELOPMENT_GUIDE.md" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; margin: 10px 5px; border: 2px solid rgba(255, 255, 255, 0.3);">🔧 Developer Guide</a>
                <a href="demo.html" style="display: inline-block; padding: 12px 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 25px; font-weight: bold; margin: 10px 5px; border: 2px solid rgba(255, 255, 255, 0.3);">🚀 Try Demo</a>
            </div>
        </div>

        <!-- Back to Home -->
        <div style="text-align: center; margin-top: 40px;">
            <a href="../index.html" class="back-link">← Back to Home</a>
        </div>
    </div>
</body>
</html>
