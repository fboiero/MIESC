# MIESC - Referencia R√°pida Multi-Contrato

## üöÄ Comandos M√°s Usados

### An√°lisis B√°sico
```bash
# Carpeta local con visualizaci√≥n
python main_project.py contracts/ output --visualize --use-ollama

# GitHub repo
python main_project.py https://github.com/user/repo output --use-ollama

# An√°lisis r√°pido
python main_project.py contracts/ output --quick
```

### An√°lisis Avanzado
```bash
# Solo contratos cr√≠ticos
python main_project.py contracts/ output --priority-filter high --use-ollama

# Top 10 m√°s importantes
python main_project.py contracts/ output --max-contracts 10 --use-ollama

# An√°lisis exhaustivo (ambas estrategias)
python main_project.py contracts/ output --strategy both --visualize --use-ollama
```

### Solo Exploraci√≥n
```bash
# Ver estructura sin analizar
python src/project_analyzer.py contracts/

# Solo generar visualizaci√≥n
python main_project.py contracts/ output --visualize --max-contracts 0
```

---

## üìã Opciones del Comando

| Opci√≥n | Descripci√≥n | Ejemplo |
|--------|-------------|---------|
| `--strategy` | scan \| unified \| both | `--strategy scan` |
| `--visualize` | Generar gr√°ficos | `--visualize` |
| `--use-ollama` | Usar Ollama AI | `--use-ollama` |
| `--ollama-model` | Modelo espec√≠fico | `--ollama-model codellama:7b` |
| `--quick` | Modo r√°pido (7b) | `--quick` |
| `--priority-filter` | high \| medium \| low | `--priority-filter high` |
| `--max-contracts` | L√≠mite de contratos | `--max-contracts 10` |

---

## üéØ Estrategias de An√°lisis

### Scan (Individual)
```bash
python main_project.py contracts/ output --strategy scan
```
**‚úÖ Usa cuando:**
- Proyecto con >5 contratos
- Necesitas identificar problemas espec√≠ficos
- Quieres reportes separados

**üìÅ Output:**
```
output/
‚îú‚îÄ‚îÄ Token/
‚îÇ   ‚îú‚îÄ‚îÄ Ollama.txt
‚îÇ   ‚îî‚îÄ‚îÄ Slither.txt
‚îú‚îÄ‚îÄ Sale/
‚îî‚îÄ‚îÄ Staking/
```

### Unified (Unificado)
```bash
python main_project.py contracts/ output --strategy unified
```
**‚úÖ Usa cuando:**
- Proyecto peque√±o (<5 contratos)
- Quieres an√°lisis r√°pido
- Necesitas vista global

**üìÅ Output:**
```
output/
‚îú‚îÄ‚îÄ unified_contract.sol
‚îî‚îÄ‚îÄ unified/
    ‚îú‚îÄ‚îÄ Ollama.txt
    ‚îî‚îÄ‚îÄ Slither.txt
```

### Both (Ambas)
```bash
python main_project.py contracts/ output --strategy both
```
**‚úÖ Usa cuando:**
- Auditor√≠a cr√≠tica
- Proyecto complejo
- M√°xima cobertura

**üìÅ Output:**
```
output/
‚îú‚îÄ‚îÄ scan/
‚îÇ   ‚îú‚îÄ‚îÄ Token/
‚îÇ   ‚îú‚îÄ‚îÄ Sale/
‚îÇ   ‚îî‚îÄ‚îÄ Staking/
‚îî‚îÄ‚îÄ unified/
    ‚îî‚îÄ‚îÄ unified_contract.sol
```

---

## üìä Visualizaciones

### Archivos Generados

Con `--visualize`:
```
output/<tag>/visualizations/
‚îú‚îÄ‚îÄ dependency_graph.html  ‚≠ê Abre este primero
‚îú‚îÄ‚îÄ dependency_graph.mmd   üìù Para README.md
‚îú‚îÄ‚îÄ dependency_graph.dot   üñºÔ∏è  Para Graphviz
‚îî‚îÄ‚îÄ dependency_tree.txt    üå≥ Para consola
```

### Ver Visualizaci√≥n
```bash
# macOS
open output/myproject/visualizations/dependency_graph.html

# Linux
xdg-open output/myproject/visualizations/dependency_graph.html

# Windows
start output/myproject/visualizations/dependency_graph.html
```

### Usar Mermaid en GitHub

Copia el contenido de `dependency_graph.mmd` a tu README.md:

\`\`\`mermaid
graph TD
  Token[Token\\n250 lines, 15 fn]:::contract
  Sale[Sale\\n180 lines, 12 fn]:::contract
  Token -.->|inherits| ERC20
  Sale -->|imports| Token
\`\`\`

---

## üîç Filtros y L√≠mites

### Por Prioridad
```bash
# Solo cr√≠ticos
--priority-filter high

# Medianos y cr√≠ticos
--priority-filter medium

# Todos (default)
# sin flag
```

### Por Cantidad
```bash
# Top 5
--max-contracts 5

# Top 10
--max-contracts 10

# Todos (default)
# sin flag
```

### Combinado
```bash
# Top 3 cr√≠ticos
python main_project.py contracts/ output \
  --priority-filter high \
  --max-contracts 3 \
  --use-ollama
```

---

## ü§ñ Modelos de Ollama

### R√°pido (Desarrollo Diario)
```bash
--quick
# o
--ollama-model codellama:7b
```
- ‚ö° ~30s por contrato
- üí∞ $0
- ‚úÖ Calidad: Buena

### Balanceado (Recomendado)
```bash
--ollama-model codellama:13b
```
- ‚ö° ~60s por contrato
- üí∞ $0
- ‚úÖ Calidad: Muy buena

### M√°xima Calidad (Auditor√≠as)
```bash
--ollama-model deepseek-coder:33b
```
- ‚ö° ~120s por contrato
- üí∞ $0
- ‚úÖ Calidad: Excelente

**Descargar modelos:**
```bash
ollama pull codellama:7b
ollama pull codellama:13b
ollama pull deepseek-coder:33b
```

---

## üìñ Casos de Uso Comunes

### Caso 1: Primera Vez con un Proyecto

```bash
# 1. Ver estructura
python src/project_analyzer.py contracts/

# 2. Generar visualizaci√≥n
python main_project.py contracts/ explore --visualize --max-contracts 0

# 3. Abrir gr√°fico
open output/explore/visualizations/dependency_graph.html

# 4. An√°lisis completo
python main_project.py contracts/ full --strategy scan --use-ollama
```

### Caso 2: An√°lisis Pre-Deploy

```bash
# R√°pido y efectivo
python main_project.py contracts/ pre_deploy \
  --strategy unified \
  --quick
```

### Caso 3: Auditor√≠a Completa

```bash
# Exhaustivo
python main_project.py contracts/ audit \
  --strategy both \
  --visualize \
  --use-ollama \
  --ollama-model deepseek-coder:33b
```

### Caso 4: An√°lisis de GitHub

```bash
# Clonar y analizar
python main_project.py \
  https://github.com/OpenZeppelin/openzeppelin-contracts \
  oz_analysis \
  --visualize \
  --max-contracts 10 \
  --priority-filter high \
  --use-ollama
```

### Caso 5: Solo Contratos Cr√≠ticos

```bash
# Enfoque en lo importante
python main_project.py contracts/ critical \
  --priority-filter high \
  --use-ollama \
  --ollama-model codellama:13b
```

---

## üêõ Soluci√≥n R√°pida de Problemas

### Problema: "Git clone failed"
```bash
# Clonar manualmente primero
git clone https://github.com/user/repo temp
python main_project.py temp/ output --use-ollama
```

### Problema: "No .sol files found"
```bash
# Verificar ubicaci√≥n
find . -name "*.sol"

# Usar ruta correcta
python main_project.py ./src/ output --use-ollama
```

### Problema: "Ollama not found"
```bash
# Verificar Ollama
ollama --version

# Agregar a PATH
export PATH="/usr/local/bin:$PATH"

# O abrir Ollama app
open -a Ollama
```

### Problema: "Model not found"
```bash
# Descargar modelo
ollama pull codellama:13b

# Verificar modelos instalados
ollama list
```

### Problema: "Out of memory"
```bash
# Usar modelo m√°s peque√±o
python main_project.py contracts/ output --quick

# O reducir cantidad
python main_project.py contracts/ output --max-contracts 5
```

---

## üìà Tiempos Estimados

| Contratos | Quick (7b) | Balanced (13b) | Quality (33b) |
|-----------|------------|----------------|---------------|
| 1-3       | ~2 min     | ~4 min         | ~8 min        |
| 4-10      | ~5 min     | ~10 min        | ~20 min       |
| 11-20     | ~10 min    | ~20 min        | ~40 min       |
| 20+       | ~15+ min   | ~30+ min       | ~60+ min      |

*Tiempos aproximados en Apple Silicon M1/M2*

---

## üéØ Recomendaciones por Escenario

### Desarrollo Diario
```bash
python main_project.py contracts/ dev \
  --strategy unified \
  --quick
```
‚ö° R√°pido | ‚úÖ Suficiente | üí∞ $0

### Pre-Commit / CI/CD
```bash
python main_project.py contracts/ ci \
  --strategy unified \
  --use-ollama \
  --ollama-model codellama:7b \
  --max-contracts 5
```
‚ö° R√°pido | ‚úÖ Bueno | üí∞ $0

### Pre-Deploy Review
```bash
python main_project.py contracts/ staging \
  --strategy scan \
  --use-ollama \
  --ollama-model codellama:13b \
  --priority-filter high
```
‚ö° Medio | ‚úÖ Muy Bueno | üí∞ $0

### Auditor√≠a Profesional
```bash
python main_project.py contracts/ audit \
  --strategy both \
  --visualize \
  --use-ollama \
  --ollama-model deepseek-coder:33b
```
‚ö° Lento | ‚úÖ Excelente | üí∞ $0

---

## üìö Archivos de Documentaci√≥n

| Archivo | Contenido |
|---------|-----------|
| `PROJECT_ANALYSIS.md` | Gu√≠a completa y detallada |
| `MULTI_CONTRACT_SUMMARY.md` | Resumen ejecutivo |
| `IMPLEMENTACION_MULTI_CONTRATO.md` | Detalles t√©cnicos |
| `QUICK_REFERENCE_MULTI_CONTRACT.md` | Esta gu√≠a |

---

## üéì Flujo de Trabajo Recomendado

### 1. Exploraci√≥n Inicial
```bash
# Ver estructura
python src/project_analyzer.py contracts/

# Generar visualizaci√≥n
python main_project.py contracts/ explore --visualize --max-contracts 0
```

### 2. An√°lisis Incremental
```bash
# Primero cr√≠ticos
python main_project.py contracts/ phase1 \
  --priority-filter high \
  --use-ollama

# Luego el resto
python main_project.py contracts/ phase2 \
  --priority-filter medium \
  --use-ollama
```

### 3. Verificaci√≥n Final
```bash
# An√°lisis exhaustivo
python main_project.py contracts/ final \
  --strategy both \
  --visualize \
  --use-ollama \
  --ollama-model deepseek-coder:33b
```

---

## üí° Tips √ötiles

### Tip 1: Siempre Visualiza Primero
```bash
# Entender antes de analizar
python main_project.py contracts/ viz --visualize --max-contracts 0
```

### Tip 2: Usa Filtros para Proyectos Grandes
```bash
# No analices todo a la vez
python main_project.py contracts/ big \
  --priority-filter high \
  --max-contracts 10
```

### Tip 3: Guarda el Output
```bash
# Usa tags descriptivos
python main_project.py contracts/ audit_v1_2024_01_15 --strategy scan
```

### Tip 4: Combina con Git
```bash
# Tag por commit
TAG=$(git rev-parse --short HEAD)
python main_project.py contracts/ audit_$TAG --use-ollama
```

### Tip 5: Automatiza con Script
```bash
#!/bin/bash
# analyze.sh

DATE=$(date +%Y%m%d)
python main_project.py contracts/ audit_$DATE \
  --strategy scan \
  --visualize \
  --use-ollama \
  --priority-filter high

open output/audit_$DATE/visualizations/dependency_graph.html
```

---

## ‚ö° One-Liners √ötiles

```bash
# An√°lisis completo con un comando
python main_project.py contracts/ $(date +%Y%m%d) --strategy both --visualize --use-ollama --ollama-model codellama:13b

# GitHub a visualizaci√≥n
python main_project.py https://github.com/user/repo repo_viz --visualize --max-contracts 0 && open output/repo_viz/visualizations/dependency_graph.html

# Top 5 cr√≠ticos
python main_project.py contracts/ top5 --priority-filter high --max-contracts 5 --quick

# An√°lisis y abrir resultados
python main_project.py contracts/ quick --quick && ls -R output/quick/

# Ver estad√≠sticas r√°pido
python src/project_analyzer.py contracts/ | grep "Total"
```

---

## üìä Ejemplos de Output

### Estad√≠sticas
```
üìä Project Statistics
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Total Contracts        ‚îÇ 12     ‚îÇ
‚îÇ Total Lines of Code    ‚îÇ 1,584  ‚îÇ
‚îÇ Total Functions        ‚îÇ 149    ‚îÇ
‚îÇ ‚îú‚îÄ Contracts           ‚îÇ 10     ‚îÇ
‚îÇ ‚îú‚îÄ Interfaces          ‚îÇ 1      ‚îÇ
‚îÇ ‚îî‚îÄ Libraries           ‚îÇ 1      ‚îÇ
‚îÇ Avg Lines per Contract ‚îÇ 132.0  ‚îÇ
‚îÇ Pragma Versions        ‚îÇ ^0.8.0 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Plan de Escaneo
```
üìã Scan Plan
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ #  ‚îÉ Contract ‚îÉ Priority ‚îÉ Lines ‚îÉ Est. Time ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ 1  ‚îÇ Token    ‚îÇ HIGH     ‚îÇ   250 ‚îÇ      80s  ‚îÇ
‚îÇ 2  ‚îÇ Sale     ‚îÇ HIGH     ‚îÇ   180 ‚îÇ      65s  ‚îÇ
‚îÇ 3  ‚îÇ Staking  ‚îÇ MEDIUM   ‚îÇ   120 ‚îÇ      50s  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Resultados
```
‚úÖ Analysis Results
‚îè‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î≥‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îì
‚îÉ Contract ‚îÉ  Status   ‚îÉ   Time ‚îÉ
‚î°‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚ïá‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚î©
‚îÇ Token    ‚îÇ ‚úì Success ‚îÇ  72.3s ‚îÇ
‚îÇ Sale     ‚îÇ ‚úì Success ‚îÇ  68.9s ‚îÇ
‚îÇ Staking  ‚îÇ ‚úì Success ‚îÇ  50.1s ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Summary:
  ‚úì Successful: 3/3
  ‚è±Ô∏è  Total time: 191.3s
```

---

## ‚úÖ Checklist R√°pido

Antes de analizar:
- [ ] Ollama instalado (`ollama --version`)
- [ ] Modelo descargado (`ollama list`)
- [ ] Contratos en carpeta organizada
- [ ] PATH configurado correctamente

Para an√°lisis:
- [ ] ¬øQu√© estrategia necesito? (scan/unified/both)
- [ ] ¬øNecesito visualizaci√≥n? (--visualize)
- [ ] ¬øTodos o solo cr√≠ticos? (--priority-filter)
- [ ] ¬øQu√© modelo usar? (7b/13b/33b)

Despu√©s del an√°lisis:
- [ ] Revisar `output/<tag>/`
- [ ] Abrir visualizaci√≥n HTML
- [ ] Leer reportes individuales
- [ ] Verificar contratos con problemas

---

¬°Todo listo para analizar proyectos multi-contrato con MIESC! üöÄ

**Comando para empezar ahora:**
```bash
python main_project.py contracts/ myproject --visualize --use-ollama
open output/myproject/visualizations/dependency_graph.html
```
