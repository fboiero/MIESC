<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 520" font-family="Arial, Helvetica, sans-serif">
  <!-- Background -->
  <rect width="850" height="520" fill="#ffffff"/>
  
  <!-- Title -->
  <text x="425" y="28" text-anchor="middle" font-size="18" font-weight="bold" fill="#2c3e50">
    Ejemplo de InteracciÃ³n (Parte 2): CorrecciÃ³n de Vulnerabilidad
  </text>
  
  <!-- Message 3: Usuario -->
  <rect x="40" y="50" width="400" height="45" fill="#e8f4fc" rx="12" stroke="#3498db" stroke-width="2"/>
  <text x="60" y="72" font-size="13" font-weight="bold" fill="#2980b9">ğŸ‘¤ Usuario</text>
  <text x="60" y="90" font-size="12" fill="#2c3e50">SÃ­, muÃ©strame cÃ³mo arreglar el problema de reentrancy</text>
  
  <!-- Message 4: Claude - Fix -->
  <rect x="80" y="110" width="730" height="395" fill="#f5eef8" rx="12" stroke="#9b59b6" stroke-width="2"/>
  <text x="100" y="135" font-size="13" font-weight="bold" fill="#8e44ad">ğŸ¤– Claude</text>
  
  <text x="100" y="158" font-size="12" fill="#2c3e50">AquÃ­ estÃ¡ la correcciÃ³n. Recomiendo dos enfoques complementarios:</text>
  
  <!-- Fix 1: CEI Pattern -->
  <rect x="100" y="172" width="690" height="120" fill="#d4edda" rx="8" stroke="#27ae60" stroke-width="1"/>
  <text x="118" y="194" font-size="12" font-weight="bold" fill="#1e8449">âœ… Enfoque 1: PatrÃ³n Checks-Effects-Interactions</text>
  
  <rect x="118" y="205" width="500" height="80" fill="#1e272e" rx="5"/>
  <text x="128" y="223" font-size="10" font-family="Consolas, monospace" fill="#aaa">function unstake() external {</text>
  <text x="143" y="240" font-size="10" font-family="Consolas, monospace" fill="#aaa">uint256 amount = stakes[msg.sender];</text>
  <text x="143" y="257" font-size="10" font-family="Consolas, monospace" fill="#27ae60">stakes[msg.sender] = 0; // EFFECTS primero</text>
  <text x="143" y="274" font-size="10" font-family="Consolas, monospace" fill="#3498db">payable(msg.sender).call{value: amount}(""); // DESPUÃ‰S</text>
  <text x="128" y="288" font-size="10" font-family="Consolas, monospace" fill="#aaa">}</text>
  
  <!-- Fix 2: ReentrancyGuard -->
  <rect x="100" y="302" width="690" height="105" fill="#d4edda" rx="8" stroke="#27ae60" stroke-width="1"/>
  <text x="118" y="324" font-size="12" font-weight="bold" fill="#1e8449">âœ… Enfoque 2: ReentrancyGuard de OpenZeppelin</text>
  
  <rect x="118" y="335" width="500" height="62" fill="#1e272e" rx="5"/>
  <text x="128" y="353" font-size="10" font-family="Consolas, monospace" fill="#9b59b6">import "@openzeppelin/.../ReentrancyGuard.sol";</text>
  <text x="128" y="373" font-size="10" font-family="Consolas, monospace" fill="#aaa">contract Staking is ReentrancyGuard {</text>
  <text x="143" y="393" font-size="10" font-family="Consolas, monospace" fill="#f39c12">function unstake() external nonReentrant { }</text>
  
  <!-- Recommendation -->
  <rect x="100" y="417" width="690" height="55" fill="#e8daef" rx="8"/>
  <text x="118" y="440" font-size="11" fill="#5b2c6f">ğŸ’¡ Recomiendo usar ambos: CEI como prÃ¡ctica de codificaciÃ³n</text>
  <text x="118" y="458" font-size="11" fill="#5b2c6f">y ReentrancyGuard como defensa adicional (defensa en profundidad).</text>
  
  <!-- Follow-up - DENTRO del contenedor morado -->
  <text x="100" y="490" font-size="11" fill="#8e44ad" font-style="italic">
    "Â¿Quieres que analice el contrato de nuevo despuÃ©s de las correcciones?"
  </text>
</svg>
